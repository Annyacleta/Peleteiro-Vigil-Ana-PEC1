
---
title: "Análisis de Datos Ómicos - PEC 1"
author: "Ana Peleteiro Vigil"
lang: es
format:
  pdf:
    include-in-header: header.tex
    pdf-engine: xelatex
    keep-tex: true
    toc: true
    number-sections: true
    toc-depth: 2
knit:
  quarto:
    chunk_options:
      echo: false
      cache: false
      prompt: false
      tidy: true
      comment: NA
      message: false
      warning: false
    knit_options:
      width: 75
---

# Abstract
**150 palabras**

Los datos seleccionados para esta PEC provienen del análisis por LC-MS de muestras fecales de ratones con cáncer colorectal que recibieron un trasplante de microbiota de ratones sometidos a una dieta cetogénica o a una dieta estándar. tras un análisis exploratorio con XXXXXXX, comparé el metaboloma fecal de los dos grupos de ratones trasplantados para detectar diferencias en su composición, como señalan los autores del estudio. Encontré que....

HABLAR DEL PROCESO Y PRINCIPALES RESULTADOS ANALISIS EXPLORATORIO
OJO mi dataset quizás fue solo para caracterizar metabolómicamente los ratones GF trasplantados


# Objetivos
**Media página**

**Objetivo global**: Comparar los metabolitos en heces de los ratones trasplantados con "microbiota estándar" (SC) y aquellos con "microbiota cetogénica" (KC) para detectar diferencias en el perfil metabolómico.

**Objetivos específicos**:

1. Crear un objeto de clase `SummarizedExperiment` que contenga los datos y los metadatos del dataset seleccionado.

2. Realizar un análisis de datos exploratorio para !!describir-> dimensiones, números de grupos, número de muestras, nombre de los grupos, número de metabolitos, número de medidas (formato tabla). Histogramas? barplot con la cantidad de cada metabolito en los ratones, diferenciando por colores según grupo. Visualización/agrupación multivariante: Mostrar PC1 y PC2 para agrupar muestras, dendrograma para ver si se da un agrupamiento jerárquico de las muestras. volcano plot??


# Métodos
**1-2 páginas**

## Archivos derivados de esta PEC

En el repositorio de GitHub$^{1}$, se pueden encontrar los diferentes archivos solicitados para la evaluación de este trabajo:

- Informe: Peleteiro-Vigil-Ana-PEC1.qmd

- Objeto `SummarizedExperiment`: SummarizedExperiment_metabolomics.Rda

- Código R comentado: 0_CreacionSumExp_code.R, 1_AnalisisExp_code.R

- Datos: ST003680_AN006041_metadata_data.txt

- Metadatos: Metadatos.md


## Origen y naturaleza de los datos

El dataset empleado para este ejercicio ha sido extraído del repositorio del Metabolomics Workbench (https://www.metabolomicsworkbench.org/). A continuación, muestro la información más básica que identifica el experimento escogido:

- ID del proyecto: PR002283 ("Ketogenic diet suppresses colorectal cancer through the gut microbiome long chain fatty acid stearate")

- Fecha de publicación: 20-01-2025

- ID del estudio: ST003680 ("Untargeted LCMS data from Cecal Microbiota Transplant (CMT) experiment")

He seleccionado este reciente estudio por la robustez del diseño experimental, la novedad y su impacto en el conocimiento de los efectos de la microbiota sobre la fisiopatología del cáncer, un campo en el he tenido experiencia. Además, a pesar de no haber trabajado con datos de metabólomica previamente, el dataset me ha parecido relativamente fácil de interpretar y con la información suficiente para desarrollar esta actividad.

El dataset con el que he trabajado procede de un experimento con ratones libres de gérmenes, que recibieron contenido cecal (del ciego, en el intestino grueso) de ratones alimentados con una dieta cetogénica (KC) o con una dieta estándar (SC). Después, estos ratones fueron sometidos al tratamiento con AOM/DSS, inductor de carcinogénesis y colitis, según lo descrito en Tsenkova et al. (2025)$^{2}$ (Figura 1).

![Representación esquemática del montaje experimental de transferencia microbiana cecal en la instalación *germ-free* (Creado en BioRender. Rodriguez, F. (2024) BioRender.com/w69g496).](Figura_1.png){#fig-id width=100% fig-align="center"}$^{2}$

Las muestras fecales de los ratones se analizaron mediante una estrategia de LC-MS para caracterizar el metaboloma fecal de los diferentes grupos experimentales. Los metabolitos se extrajeron de las muestras fecales de ratón y las muestras resultantes se utilizaron para un análisis de metabolómica no dirigida por LC-MS, utilizando un sistema Vanquish UHPLC acoplado a un espectrómetro de masas Q Exactive HF.


## Herramientas estadísticas y bioinformáticas

Para el desarrollo de esta actividad, se empleó el lenguaje de programación R versión 4.4.3 (2025-02-28 ucrt) junto con el siguiente software:

- **RStudio** 2024.12.1+563 "Kousa Dogwood" Release (2025-02-02) for windows
Mozilla/5.0 (Windows NT 10.0; Win64; x64)

- **Paquetes**: RMarkdown 2.29, BiocManager 1.30.25, SummarizedExperiment 1.34.0, tidyverse 2.0.0

NOTA: Siguiendo las recomendaciones del repositorio Metabolomics Workbench, inicialmente opté por descargar el archivo comprimido con los datos crudos de todas las muestras (12 GB) en formato .mzML mediante FileZilla, un cliente FTP gratuito. Después, hice un preprocesado con MSconvertGUI $^{3}$ para obtener una tabla de intensidades. Este software libre permite reducir notablemente el tamaño de los archivos (en este caso, pasaron de ocupar 16 GB a 6 GB). Sin embargo, mi ordenador no pudo procesarlos en RStudio y, finalmente, descargué los datos procesados y metadatos en formato .txt.


## Procedimiento del análisis

- **Preprocesado**. No fue necesario, ya que los datos que utilicé no fueron crudos. En el artículo original$^{ref}$, los autores indican que procesaron los datos brutos con TraceFinder (versión 5.1.203.0) para la identificación y anotación de picos. 


- **Análisis de datos exploratorio**.

---> descriptivo, ver agrupaciones según metabolitos, clustering; volcano plot? 


# Resultados
**4-5 páginas**
**código, análisis, resultados con tablas y figuras, y explicaciones**

## Creación de un objeto de la clase `SummarizedExperiment`

El archivo .txt descargado de Metabolomics Workbench me permitió proceder con los objetivos de esta PEC y generar un objeto de la clase `SummarizedExperiment`. La clase `SummarizedExperiment` representa una evolución significativa respecto a `ExpressionSet`, diseñada para adaptarse a las necesidades de los datos ómicos modernos. Mientras `ExpressionSet` se limitaba a una única matriz de datos, `SummarizedExperiment` permite almacenar múltiples matrices (`assays`), ofreciendo mayor flexibilidad para diversos tipos de experimentos ómicos. Una ventaja clave de `SummarizedExperiment` es su capacidad para coordinar eficientemente los metadatos y los datos observados durante las operaciones de subconjunto, reduciendo el riesgo de errores en el análisis. Además, su estructura más flexible en la información de filas, que puede incluir tanto objetos `GRanges` como `DataFrames` arbitrarios, la hace ideal para experimentos de secuenciación como RNA-Seq y ChIP-Seq, convirtiéndola en la opción recomendada para el manejo de datos ómicos complejos en el ecosistema de Bioconductor.$^{4}$

En el chunk de código que muestro a continuación, creé un objeto de clase 
`SummarizedExperiment` a partir de un archivo de los datos de metabolómica *untargeted* seleccionados. Primero leí el archivo completo como texto para localizar, mediante etiquetas (MS_METABOLITE_DATA_START/END), la sección que contiene la matriz de expresión, en formato metabolitos × muestras. Extraje esa tabla, convertí los datos a formato numérico y la traspuse para que quedara en el formato adecuado para `SummarizedExperiment`: muestras en filas y metabolitos en columnas. A continuación, construí `colData` con los metadatos de las muestras fecales, asignando a cada una su condición experimental (contenido cecal de ratones donantes con dieta cetogénica o con dieta estándar). Después, extraje `rowData` desde otra sección del archivo delimitada por METABOLITES_START/END, que contenía los nombres de los metabolitos y sus tiempos de retención. Finalmente, ensamblé el objeto `SummarizedExperiment`, incorporando tanto la matriz de intensidades como los metadatos, convirtiendo `colData` y `rowData` en objetos `DataFrame()` para asegurar compatibilidad con la estructura de Bioconductor.

El código completo (con metadatos) se puede consultar en el archivo 
`0_CreacionSumExp_code.R`, disponible en el repositorio de GitHub de esta PEC$^{1}$.

```{r}
#| message: false
#| warning: false
#### DATOS
library(SummarizedExperiment)
library(tidyverse)

# 1. Leo archivo completo como texto
file <- "ST003680_AN006041_metadata_data.txt"
raw_lines <- readLines(file)

# 2. Localizo las secciones de datos,
# según etiquetas y leyendo las líneas correspondientes

#inicio datos MS metabolitos
start_data <- grep("MS_METABOLITE_DATA_START", raw_lines) + 2
#fin datos MS metabolitos
end_data   <- grep("MS_METABOLITE_DATA_END", raw_lines) - 1
#inicio metadatos metabolitos
start_meta_rt <- grep("METABOLITES_START", raw_lines) + 1
#fin metadatos metabolitos
end_meta_rt   <- grep("METABOLITES_END", raw_lines) - 1

# 3. Leo la matriz de expresión (está en formato metabolitos × muestras)
expr_raw <- read.delim(file, 
                       skip = start_data - 1, 
                       nrows = 175, 
                       check.names = FALSE)

# 4. Con header para futuro procesado
expr_raw_HEADER <- read.delim(file, 
                              skip = start_data - 2, nrows = 177, 
                              check.names = FALSE) 

# Convierto datos a numéricos y traspongo
# (metabolitos x muestras -> muestras × metabolitos,
# formato que acepta SumExp)
# Luego traspondré otra vez

expr_data <- apply(expr_raw[, -1], 2, as.numeric) %>% 
  t() %>%
  as.data.frame()

# 5. COLDATA -- Metadatos de muestras:  nombres y condiciones
# (irán en columnas en objeto se)

# Nombres de muestras sin término "Samples"
rownames(expr_data) <- colnames(expr_raw_HEADER)[-1]

#condiciones experimentales: keto y estándar
condition <- c(rep("KC", 8), rep("SC", 8)) 

col_data <- data.frame(
  condition = condition,
  row.names = rownames(expr_data),
  stringsAsFactors = FALSE)

# 6. ROWDATA -- metadatos de metabolitos: nombres y tiempos de retención
# (irán en filas en objeto se)

metabolite_meta <- read.delim(file,
                              skip = start_meta_rt - 1,
                              nrows = end_meta_rt - start_meta_rt,
                              stringsAsFactors = FALSE)

# Asigno nombres de columnas directamente
colnames(metabolite_meta) <- c("metabolite_name", "retention_time")

# 7. Creo la clase SummarizedExperiment con sus atributos;
# conversión a DataFrame() permite estructuras más complejas

se <- SummarizedExperiment(
  assays = list(intensity = t(expr_data)),  #datos
  rowData = DataFrame(metabolite_meta),   # Metabolitos en filas
  colData = DataFrame(col_data) )   # Muestras en columnas

# Filas con los nombres de los metabolitos
rownames(se) <- as.character(metabolite_meta[[1]])
```


## Análisis exploratorio

```{r}
#Análisis exploratorio

```



# Discusión


Reflexiones sobre limitaciones del estudio y sobre el trabajo realizado, en el contexto del problema biológico.
(Breve info del paper, tener en cuenta las bacterias que hay presentes en cada tipo de microbiota. Relación con efecto antitumoral-> esta parte no la he analizado, así que es una limitación de mi trabajo! se trata de un análisis parcial). Quizás con alguna figura del paper se puedan hacer comparaciones, pero no parece -> OJO mi dataset quizás fue solo para caracterizar metabolómicamente los ratones GF trasplantados

1 página


# Conclusiones


Media página: utilidad e interés de `SummarizedExperiment`, versatilidad que permite al incorporar más datos de las variables y metadatos del estudio


# Referencias

1. Peleteiro-Vigil, A. Peleteiro-Vigil-Ana-PEC1 [Internet]. GitHub; 2025. Disponible en: https://github.com/Annyacleta/Peleteiro-Vigil-Ana-PEC1 **Repositorio PEC1**

2. Tsenkova, M., Brauer, M., Pozdeev, V.I. et al. Ketogenic diet suppresses colorectal cancer through the gut microbiome long chain fatty acid stearate. Nat Commun 16, 1792 (2025). https://doi.org/10.1038/s41467-025-56678-0

3. Chambers, M., Maclean, B., Burke, R. et al. A cross-platform toolkit for mass spectrometry and proteomics. Nat Biotechnol 30, 918–920 (2012). https://doi.org/10.1038/nbt.2377

4. Morgan M, Obenchain V, Hester J, Pagès H. SummarizedExperiment for Coordinating Experimental Assays, Samples, and Regions of Interest [Internet]. Bioconductor; 2023 [consultado 2025 mar 23]. Disponible en: https://bioconductor.org/packages/release/bioc/vignettes/SummarizedExperiment/inst/doc/SummarizedExperiment.html


---
title: "Análisis de Datos Ómicos - PEC 1"
author: "Ana Peleteiro Vigil"
lang: es
format:
  pdf:
    include-in-header: header.tex
    pdf-engine: xelatex
    keep-tex: true
    toc: true
    number-sections: true
    toc-depth: 2
knit:
  quarto:
    chunk_options:
      echo: false
      cache: false
      prompt: false
      tidy: true
      comment: NA
      message: false
      warning: false
    knit_options:
      width: 75
---

# Abstract **150 palabras**

El experimento seleccionado se planteó para investigar el efecto de la microbiota intestinal en el perfil metabolómico fecal de ratones con cáncer colorrectal. Se analizaron 175 metabolitos mediante LC-MS en 16 muestras fecales de ratones trasplantados con microbiota cecal de donantes alimentados con dieta cetogénica (KC) o estándar (SC). El análisis exploratorio del dataset transformado a objeto `SummarizedExperiment` en RStudio reveló diferencias notables entre los grupos. Específicamente, [mencionar 1-2 metabolitos/tendencias clave, p.ej., "los niveles de X fueron significativamente mayores en el grupo KC" o "se observó una tendencia a la disminución de Y en el grupo SC"]. Estos resultados preliminares sugieren que la modulación dietética de la microbiota influye en el metaboloma en el contexto del cáncer colorrectal.


# Objetivos

**Objetivo global**: Identificar las diferencias en el perfil metabolómico fecal de ratones con cáncer colorrectal trasplantados con microbiota cecal proveniente de donantes alimentados con dieta cetogénica (KC) frente a dieta estándar (SC).

**Objetivos específicos**:

1. Construir un objeto `SummarizedExperiment` integrando matriz de intensidades, metadatos de metabolitos (nombre, tiempo de retención) y metadatos de muestras (condición experimental).

2. Realizar un análisis descriptivo básico del objeto `SummarizedExperiment` para extraer conclusiones biológicas preliminares a partir de la exploración de los datos.

# Métodos

## Archivos derivados de esta PEC

En el repositorio de GitHub$^{1}$, se pueden encontrar los diferentes archivos solicitados para la evaluación de este trabajo:

| Archivo                        | Nombre                                  |
|:-------------------------------|:---------------------------------------|
| Informe                        | Peleteiro-Vigil-Ana-PEC1.qmd           |
| Objeto `SummarizedExperiment`  | SummarizedExperiment_metabolomics.Rda  |
| Código R comentado             | 0_CreacionSumExp_code.R, 1_AnalisisExp_code.R |
| Datos                          | ST003680_AN006041_metadata_data.txt    |
| Metadatos                      | Metadatos.md                           |

## Origen y naturaleza de los datos

El dataset empleado para este ejercicio ha sido extraído del repositorio del Metabolomics Workbench (<https://www.metabolomicsworkbench.org/>). A continuación, muestro la información más básica que identifica el experimento escogido:

- Proyecto: *Ketogenic diet suppresses colorectal cancer through the gut microbiome long chain fatty acid stearate* (PR002283)

- Fecha de publicación: 20-01-2025

- Estudio: *Untargeted LCMS data from Cecal Microbiota Transplant (CMT) experiment* (ST003680)

He seleccionado este reciente estudio por la robustez del diseño experimental, la novedad y su impacto en el conocimiento de los efectos de la microbiota sobre la fisiopatología del cáncer, un campo en el he tenido experiencia. Además, a pesar de no haber trabajado con datos de metabólomica previamente, el dataset me ha parecido relativamente fácil de interpretar y con la información suficiente para desarrollar esta actividad.

El dataset con el que he trabajado procede de un experimento con ratones libres de gérmenes, que recibieron contenido cecal (del ciego, en el intestino grueso) de ratones alimentados con una dieta cetogénica (KC) o con una dieta estándar (SC). Después, estos ratones fueron sometidos al tratamiento con AOM/DSS, inductor de carcinogénesis y colitis, según lo descrito en Tsenkova *et al.* (2025)$^{2}$ (Figura 1).

![Representación esquemática del montaje experimental de transferencia microbiana cecal en la instalación *germ-free* (Creado en BioRender. Rodriguez, F. (2024) BioRender.com/w69g496)$^{2}$.](Figura_1.png){#fig-id width=100% fig-align="center"}

Las muestras fecales de los ratones se analizaron mediante una estrategia de LC-MS para caracterizar el metaboloma fecal de los diferentes grupos experimentales. Los metabolitos se extrajeron de las muestras fecales de ratón y las muestras resultantes se utilizaron para un análisis de metabolómica no dirigida por LC-MS.


## Herramientas estadísticas y bioinformáticas

Para el desarrollo de esta actividad, se empleó el lenguaje de programación R versión 4.4.3 (2025-02-28 ucrt) junto con el siguiente software:

- **RStudio** 2024.12.1+563 "Kousa Dogwood" Release (2025-02-02) for windows

- **Paquetes**: RMarkdown 2.29, BiocManager 1.30.25, SummarizedExperiment 1.34.0, tidyverse 2.0.0

NOTA: Siguiendo las recomendaciones del repositorio Metabolomics Workbench, inicialmente opté por descargar el archivo comprimido con los datos crudos de todas las muestras (12 GB) en formato .mzML mediante FileZilla, un cliente FTP gratuito. Después, hice un preprocesado con MSconvertGUI$^{3}$ para obtener una tabla de intensidades. Este software libre permite reducir notablemente el tamaño de los archivos (en este caso, pasaron de ocupar 16 GB a 6 GB). Sin embargo, mi ordenador no pudo procesarlos en RStudio y, finalmente, descargué los datos procesados y metadatos en formato .txt.

## Procedimiento del análisis

El preprocesado no fue necesario, ya que los datos que utilicé no fueron crudos. En el artículo original$^{2}$, los autores indican que procesaron los datos brutos con TraceFinder (versión 5.1.203.0) para la identificación y anotación de picos. 

A partir del archivo `ST003680_AN006041_metadata_data.txt`, generé un objeto de la clase `SummarizedExperiment`, incluyendo datos y metadatos del conjunto seleccionado. Después, inspeccioné este nuevo objeto para recoger sus características y desarrollar el análisis exploratorio (univariante y multivariante) en R.

# Resultados

## Creación de un objeto de la clase `SummarizedExperiment`

El archivo .txt descargado de Metabolomics Workbench me permitió proceder con los objetivos de esta PEC y generar un objeto de la clase `SummarizedExperiment`. La clase `SummarizedExperiment` representa una evolución significativa respecto a `ExpressionSet`, diseñada para adaptarse a las necesidades de los datos ómicos modernos. Mientras `ExpressionSet` se limitaba a una única matriz de datos, `SummarizedExperiment` permite almacenar múltiples matrices (`assays`), ofreciendo mayor flexibilidad para diversos tipos de experimentos ómicos. Una ventaja clave de `SummarizedExperiment` es su capacidad para coordinar eficientemente los metadatos y los datos observados durante las operaciones de subconjunto, reduciendo el riesgo de errores en el análisis. Además, su estructura más flexible en la información de filas, que puede incluir tanto objetos `GRanges` como `DataFrames` arbitrarios, la hace ideal para experimentos de secuenciación como RNA-Seq y ChIP-Seq, convirtiéndola en la opción recomendada para el manejo de datos ómicos complejos en el ecosistema de Bioconductor$^{4}$.

En el chunk de código inferior, creé un objeto de clase `SummarizedExperiment` a partir de un archivo de los datos de metabolómica *untargeted* seleccionados. Primero leí el archivo completo como texto para localizar, mediante etiquetas (`MS_METABOLITE_DATA_START/ END`), la sección que contiene la matriz de expresión, en formato metabolitos × muestras. Extraje esa tabla, convertí los datos a formato numérico y la traspuse para que quedara en el formato adecuado para `SummarizedExperiment`: muestras en filas y metabolitos en columnas. A continuación, construí `colData` con los metadatos de las muestras fecales, asignando a cada una su condición experimental (contenido cecal de ratones donantes con dieta cetogénica o con dieta estándar). Después, extraje `rowData` desde otra sección del archivo delimitada por `METABOLITES_START/ END`, que contenía los nombres de los metabolitos y sus tiempos de retención. Finalmente, ensamblé el objeto `SummarizedExperiment`, incorporando tanto la matriz de intensidades como los metadatos, convirtiendo `colData` y `rowData` en objetos `DataFrame()` para asegurar compatibilidad con la estructura de Bioconductor.

El código completo (con metadatos) se puede consultar en el archivo 0_CreacionSumExp_code.R, disponible en el repositorio de GitHub de esta PEC$^{1}$.

```{r}
#| message: false
#| warning: false
#### DATOS
library(SummarizedExperiment)
library(tidyverse)

# 1. Leo archivo completo como texto
file <- "ST003680_AN006041_metadata_data.txt"
raw_lines <- readLines(file)

# 2. Localizo las secciones de datos,
# según etiquetas y leyendo las líneas correspondientes

#inicio datos MS metabolitos
start_data <- grep("MS_METABOLITE_DATA_START", raw_lines) + 2
#fin datos MS metabolitos
end_data   <- grep("MS_METABOLITE_DATA_END", raw_lines) - 1
#inicio metadatos metabolitos
start_meta_rt <- grep("METABOLITES_START", raw_lines) + 1
#fin metadatos metabolitos
end_meta_rt   <- grep("METABOLITES_END", raw_lines) - 1

# 3. Leo la matriz de expresión (está en formato metabolitos × muestras)
expr_raw <- read.delim(file, 
                       skip = start_data - 1, 
                       nrows = 175, 
                       check.names = FALSE)

# Con header para futuro procesado
expr_raw_HEADER <- read.delim(file, 
                              skip = start_data - 2, nrows = 177, 
                              check.names = FALSE) 

# Convierto datos a numéricos y traspongo
# (metabolitos x muestras -> muestras × metabolitos,
# formato que acepta SumExp)
# Luego traspondré otra vez

expr_data <- apply(expr_raw[, -1], 2, as.numeric) %>% 
  t() %>%
  as.data.frame()

# 4. COLDATA -- Metadatos de muestras:  nombres y condiciones
# (irán en columnas en objeto se)

# Nombres de muestras sin término "Samples"
rownames(expr_data) <- colnames(expr_raw_HEADER)[-1]

#condiciones experimentales: keto y estándar
condition <- c(rep("KC", 8), rep("SC", 8)) 

col_data <- data.frame(
  condition = condition,
  row.names = rownames(expr_data),
  stringsAsFactors = FALSE)

# 5. ROWDATA -- metadatos de metabolitos: nombres y tiempos de retención
# (irán en filas en objeto se)

metabolite_meta <- read.delim(file,
                              skip = start_meta_rt - 1,
                              nrows = end_meta_rt - start_meta_rt,
                              stringsAsFactors = FALSE)

# Asigno nombres de columnas directamente
colnames(metabolite_meta) <- c("metabolite_name", "retention_time")

# 6. Creo la clase SummarizedExperiment con sus atributos;
# la conversión a DataFrame() permite estructuras más complejas

se <- SummarizedExperiment(
  assays = list(intensity = t(expr_data)),  #datos
  rowData = DataFrame(metabolite_meta),   # Metabolitos en filas
  colData = DataFrame(col_data) )   # Muestras en columnas

# Filas con los nombres de los metabolitos
rownames(se) <- as.character(metabolite_meta[[1]])
```


El código de los siguientes apartados se pueden consultar en el archivo 1_AnalisisExp_code.R, disponible en el repositorio de GitHub de esta PEC$^{1}$. A continuación presentaré un breve análisis descriptivos de los datos.

## Inspección preliminar del dataset

El conjunto de datos tiene 175 metabolitos (filas) y 16 muestras (columnas), divididas en dos grupor según la condición experimental (KC, SC). En la Tabla 1 se muestran las principales características extraídas del objeto `SummarizedExperiment`.

| Característica | Descripción |
|----------------|-------------|
| Dimensiones | 175 x 16 |
| Metabolitos | 175 |
| Muestras | 16 |
| Metadatos de metabolitos | Nombre del metabolito, Tiempo de retención |
| Metadatos de muestras | Condiciones experimentales (KC, SC) |
| Valores en la matriz | Áreas normalizadas de metabolitos |
| Valores totales | 2800 |
| Valores faltantes (NA) | 1402 |

A continuación, se presentan las primeras filas y columnas del dataset en formato tabla:

```{r}
#| echo: false
#| message: false
#| warning: false
# Extraigo las medidas y selecciono algunos datos
intensidades <- assay(se)
intensidades_2 <- intensidades[2:4, 6:11]

# Conviero a dataframe y hago la tabla
intensidades_df <- as.data.frame(intensidades_2)
kableExtra::kable(intensidades_df, "pipe")
```

## Análisis de datos exploratorio 

### Análisis univariante

boxplot con la cantidad de cada metabolito en los ratones, diferenciando por colores según grupo. 

```{r}
# Media de cada metabolito por condiciones SC o KC

```


### Análisis multivariante

Visualización/agrupación multivariante: Mostrar PC1 y PC2 para agrupar muestras, dendrograma para ver si se da un agrupamiento jerárquico de las muestras.


# Discusión

Reflexiones sobre limitaciones del estudio y sobre el trabajo realizado, en el contexto del problema biológico.
(Breve info del paper, tener en cuenta las bacterias que hay presentes en cada tipo de microbiota. Relación con efecto antitumoral-> esta parte no la he analizado, así que es una limitación de mi trabajo! se trata de un análisis parcial). Quizás con alguna figura del paper se puedan hacer comparaciones, pero no parece -> OJO mi dataset quizás fue solo para caracterizar metabolómicamente los ratones GF trasplantados

1 página


# Conclusiones

Media página: utilidad e interés de `SummarizedExperiment`, versatilidad que permite al incorporar más datos de las variables y metadatos del estudio


# Referencias

1. Peleteiro-Vigil, A. Peleteiro-Vigil-Ana-PEC1 [Internet]. GitHub; 2025. Disponible en: <https://github.com/Annyacleta/Peleteiro-Vigil-Ana-PEC1>

2. Tsenkova, M., Brauer, M., Pozdeev, V.I. et al. Ketogenic diet suppresses colorectal cancer through the gut microbiome long chain fatty acid stearate. Nat Commun 16, 1792 (2025). Disponible en: <https://doi.org/10.1038/s41467-025-56678-0>

3. Chambers, M., Maclean, B., Burke, R. et al. A cross-platform toolkit for mass spectrometry and proteomics. Nat Biotechnol 30, 918–920 (2012). Disponible en: <https://doi.org/10.1038/nbt.2377>

4. Morgan M, Obenchain V, Hester J, Pagès H. SummarizedExperiment for Coordinating Experimental Assays, Samples, and Regions of Interest [Internet]. Bioconductor; 2023 [consultado 2025 mar 23]. Disponible en: <https://bioconductor.org/packages/release/bioc/vignettes/SummarizedExperiment/inst/doc/SummarizedExperiment.html>
